<div class="card m-2 mx-auto" style="width: 60%">
  <div class="card-header">
    <h3>TODO List</h3>
  </div>
  <div class="card-body">
    <form action="$(Genie.Router.link_to(:create_task))" method="POST">
      <div class="input-group mb-3">
        <input id="todo-content" class="form-control" type="text" name="task_content" placeholder="Write down your TODO"/>
        <div class="input-group-append">
          <input type="submit" value="Add" class="btn btn-sm btn-outline-primary"/>
        </div>
      </div>
    </form>
    <input type="checkbox" class="checkbox" id="done-display-checkbox" checked>
    <small class="mx-1">show done</small>

    <table class="table table-striped table-bordered table-sm">
      <thead>
        <tr>
          <th class="th-sm" style="width: 7%">done</th>
          <th class="th-sm" style="">content</th>
          <th class="th-sm" style="width: 10%">action</th>
        </tr>
      </thead>
      <tbody>
        <%
          if length(@vars(:tasks)) == 0
            "タスクがありません。"
          else
            @foreach(@vars(:tasks)) do task
              """
              <tr>
                <td>
                  <input type="checkbox" id="$(get(task.id))"
                         class="checkbox done-checkbox" $(task.done ? "checked" : "") />
                </td>
                <td>
                  <span id="content_$(get(task.id))"
                        style="text-decoration: $(task.done ? "line-through" : "none")">

                        $(task.content)
                  </span>
                </td>
                <td>
                  <form action="$(Genie.Router.link_to(:destroy_task))" method="POST"
                        onSubmit="return confirm('Are you sure?');">

                      <input type="hidden" name="task_id" value="$(get(task.id))" />
                      <input type="submit" value="Delete" class="btn btn-block btn-sm btn-outline-danger" />
                  </form>
                </td>
              </tr>
              """
            end
          end
        %>
      </tbody>
    </table>
  </div>
</div>

<script>
  \$(".done-checkbox").on("change", function() {
    \$.post("$(Genie.Router.link_to(:update_task))",
            { task_id: \$(this).attr("id"), task_done: \$(this).prop("checked") });
    if (\$(this).prop("checked")) {
        \$("#content_" + \$(this).attr("id")).css("text-decoration", "line-through");
    } else {
        \$("#content_" + \$(this).attr("id")).css("text-decoration", "none");
    }
  });

  \$("#done-display-checkbox").on("change", function() {
    if(\$(this).prop("checked")) {
      \$("tr:has(.done-checkbox:checked)").show();
    } else {
      \$("tr:has(.done-checkbox:checked)").hide();
    }
  });

  \$("#todo-content").focus();
</script>
